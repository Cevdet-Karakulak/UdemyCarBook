@using Newtonsoft.Json
@using UdemyCarBook.Dto.DashboardDtos
@model Tuple<List<BrandCarCountDto>, int, int>

<div class="col-lg-4 d-flex justify-content-center">
    <div class="card w-100">
        <div class="card-body d-flex flex-column align-items-center">
            <h4 class="card-title d-inline-block mb-3">Araç Marka Sayılar</h4>

            <!-- Grafik container -->
            <div style="height:260px; width:100%; display:flex; justify-content:center; align-items:center;">
                <canvas id="my2Chart" height="220px" style="max-width:220px;"></canvas>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    var labels = @Html.Raw(JsonConvert.SerializeObject(Model.Item1.Select(x => x.Name)));
                    var dataCounts = @Html.Raw(JsonConvert.SerializeObject(Model.Item1.Select(x => x.CarCount)));

                    var ctx = document.getElementById('my2Chart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'En Çok 7 Marka',
                                data: dataCounts,
                                backgroundColor:[
                                    'rgba(255,99,132,0.7)',
                                    'rgba(54,162,235,0.7)',
                                    'rgba(255,206,86,0.7)',
                                    'rgba(75,192,192,0.7)',
                                    'rgba(153,102,255,0.7)',
                                    'rgba(255,159,64,0.7)',
                                    'rgba(185,114,21,0.7)'
                                ],
                                borderColor:[
                                    'rgba(255,99,132,1)',
                                    'rgba(54,162,235,1)',
                                    'rgba(255,206,86,1)',
                                    'rgba(75,192,192,1)',
                                    'rgba(153,102,255,1)',
                                    'rgba(255,159,64,1)',
                                    'rgba(185,114,21,1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    align: 'center'
                                }
                            }
                        }
                    });
                });
            </script>

            <!-- Alt bilgiler: tüm marka ve araç sayısı -->
            <div class="row text-center mt-4 w-100">
                <div class="col-6">
                    <h4>@Model.Item2</h4>
                    <p class="text-muted mb-0">Araç Sayısı</p>
                </div>
                <div class="col-6">
                    <h4>@Model.Item3</h4>
                    <p class="text-muted mb-0">Marka Sayısı</p>
                </div>
            </div>
        </div>
    </div>
</div>
