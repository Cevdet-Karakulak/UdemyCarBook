@model List<UdemyCarBook.Dto.LocationDtos.LocationCarCountDto>

<div class="col-lg-4">
    <div class="card">
        <div class="card-body d-flex flex-column align-items-center">

            <h4 class="card-title mb-3">Lokasyon Verileri</h4>

            <!-- Grafik Container -->
            <div style="height:300px; width:100%; display:flex; justify-content:center; align-items:center;">
                <canvas id="my3Chart" style="max-width:500px; height:100%;"></canvas>
            </div>

            <script src="/chart.js"></script>
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    var labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.LocationName)));
                    var counts = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(x => x.CarCount)));

                    var ctx = document.getElementById('my3Chart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Müsait Araç Sayısı',
                                data: counts,
                                backgroundColor: [
                                    'rgba(255,99,132,0.7)',
                                    'rgba(54,162,235,0.7)',
                                    'rgba(255,206,86,0.7)',
                                    'rgba(75,192,192,0.7)',
                                    'rgba(153,102,255,0.7)',
                                    'rgba(255,159,64,0.7)',
                                    'rgba(185,114,21,0.7)'
                                ],
                                borderColor: [
                                    'rgba(255,99,132,1)',
                                    'rgba(54,162,235,1)',
                                    'rgba(255,206,86,1)',
                                    'rgba(75,192,192,1)',
                                    'rgba(153,102,255,1)',
                                    'rgba(255,159,64,1)',
                                    'rgba(185,114,21,1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                                        options: {
                    responsive: true,
                    maintainAspectRatio: false,   // ← ekle
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
                    });

                    // Alt bilgileri güncelle
                    document.getElementById('totalLocations').innerText = labels.length;
                    document.getElementById('totalCars').innerText = counts.reduce((sum, x) => sum + x, 0);
                });
            </script>

            <!-- Alt bilgiler -->
            <div class="row text-center mt-4 w-100">
                <div class="col-6">
                    <h4 id="totalLocations">0</h4>
                    <p class="text-muted mb-0">Lokasyon Sayısı</p>
                </div>
                <div class="col-6">
                    <h4 id="totalCars">0</h4>
                    <p class="text-muted mb-0">Müsait Araç Sayısı</p>
                </div>
            </div>
        </div>
    </div>
</div>